<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¹›æ±Ÿä¸­è€ƒæ€»åˆ†æŠ˜ç®—è®¡ç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }
        body {
            background: #f5f7fa;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .calculator-card {
            width: 100%;
            max-width: 600px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: transform 0.3s ease;
            position: relative;
        }
        .calculator-card:hover {
            transform: translateY(-3px);
        }
        /* å†å²è®°å½•æŒ‰é’®ï¼šå³ä¸Šè§’ä½ç½® */
        .history-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 4px 8px;
            background: #4299e1;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .history-btn:hover {
            background: #3182ce;
        }
        /* å†å²è®°å½•å¼¹çª—æ ·å¼ */
        .history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
        }
        .history-content {
            background: #fff;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #64748b;
        }
        .history-title {
            font-size: 18px;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }
        .history-empty {
            text-align: center;
            color: #64748b;
            padding: 30px 0;
        }
        .history-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .history-time {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 10px;
        }
        .history-total {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .history-detail {
            font-size: 13px;
            color: #4a5568;
            margin-top: 8px;
        }
        .history-detail-item {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
        }
        /* åŸæœ‰æ ·å¼ä¿æŒ */
        .card-title {
            text-align: center;
            color: #2d3748;
            font-size: 22px;
            margin-bottom: 10px;
        }
        .card-subtitle {
            text-align: center;
            color: #64748b;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 22px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .form-label {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            padding-left: 2px;
        }
        .sub-label {
            color: #64748b;
            font-size: 14px;
            font-weight: normal;
            margin-top: -8px;
            padding-left: 2px;
        }
        /* è¾“å…¥æ¡†ç»Ÿä¸€æ ·å¼ */
        .form-input {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input::placeholder {
            color: #94a3b8; /* ç»Ÿä¸€æç¤ºæ–‡å­—é¢œè‰² */
        }
        .form-input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        .select-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            padding: 6px 0;
        }
        .select-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #4a5568;
            font-size: 14px;
        }
        .select-item input {
            width: 16px;
            height: 16px;
            accent-color: #4299e1;
        }
        /* æ¨èæ ‡å‡†æ ‡ç­¾æ ·å¼ */
        .recommend-tag {
            color: #10b981;
            font-weight: 600;
            margin-left: 4px;
            font-size: 13px;
        }
        .group-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 15px 0;
        }
        .calc-btn {
            width: 100%;
            padding: 14px;
            background: #4299e1;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease, opacity 0.3s ease;
            margin: 10px 0 25px;
        }
        .calc-btn:hover {
            background: #3182ce;
        }
        .calc-btn:active {
            opacity: 0.9;
        }
        .total-result {
            text-align: center;
            padding: 18px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }
        .result-label {
            color: #4a5568;
            font-size: 15px;
            margin-bottom: 5px;
        }
        .result-value {
            color: #2d3748;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 8px; /* ç»™è¯„è¯­ç•™é—´è· */
        }
        /* è¯„è¯­æ ·å¼ */
        .result-comment {
            color: #10b981;
            font-size: 14px;
            font-weight: 600;
        }
        .detail-group {
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            padding: 15px;
            margin-bottom: 20px;
        }
        .detail-title {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            color: #4a5568;
            font-size: 14px;
        }
        .detail-label {
            flex: 1;
        }
        .detail-value {
            flex: 1;
            text-align: right;
        }
        /* æ¸©é¦¨æç¤ºæ ·å¼ */
        .tip-group {
            background-color: #fef7fb; /* æµ…ç²‰è‰²æ¸©é¦¨èƒŒæ™¯ */
            border-left: 3px solid #f6ad55; /* æ©™è‰²æç¤ºè¾¹æ¡† */
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .tip-title {
            color: #2d3748;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .tip-content {
            color: #4a5568;
            font-size: 14px;
            line-height: 1.8;
        }
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .calculator-card {
                padding: 20px 15px;
            }
            .history-btn {
                top: 20px;
                right: 20px;
                padding: 5px 10px;
                font-size: 13px;
            }
            .card-title {
                font-size: 20px;
                margin-bottom: 8px;
            }
            .select-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .result-value {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-card">
        <!-- å³ä¸Šè§’å†å²è®°å½•æŒ‰é’® -->
        <button class="history-btn" onclick="openHistoryModal()">ğŸ”</button>
        
        <!-- æ ‡é¢˜æ·»åŠ â€œæ¹›æ±Ÿâ€äºŒå­— -->
        <h2 class="card-title">æ¹›æ±Ÿä¸­è€ƒæ€»åˆ†æŠ˜ç®—è®¡ç®—å™¨</h2>
        <!-- ç§»é™¤åŸå‰¯æ ‡é¢˜ï¼ˆç§»è‡³æ¸©é¦¨æç¤ºï¼‰ -->
        <!-- 1. åŸºç¡€æ€§ç§‘ç›® -->
        <div class="form-group">
            <label class="form-label">1. åŸºç¡€æ€§ç§‘ç›®</label>
            <input type="number" id="chinese" class="form-input" placeholder="è¯­æ–‡æˆç»©ï¼ˆæ»¡åˆ†120ï¼‰" min="0" max="120">
            <input type="number" id="math" class="form-input" placeholder="æ•°å­¦æˆç»©ï¼ˆæ»¡åˆ†120ï¼‰" min="0" max="120">
            <input type="number" id="english" class="form-input" placeholder="è‹±è¯­æˆç»©ï¼ˆæ»¡åˆ†120ï¼‰" min="0" max="120">
            <input type="number" id="pe-score" class="form-input" placeholder="ä½“è‚²æˆç»©ï¼ˆæ»¡åˆ†80ï¼‰" min="0" max="80">
        </div>
        <!-- 2. ç§‘ç›®ç»„ -->
        <div class="form-group">
            <label class="form-label">2. ç§‘ç›®ç»„</label>
            
            <!-- ç‰©ç†+å†å²ç»„ -->
            <div class="sub-label">2.1 ç‰©ç†+å†å²ç»„</div>
            <input type="number" id="physics-written" class="form-input" placeholder="ç‰©ç†ç¬”è¯•æˆç»©ï¼ˆæ»¡åˆ†100åˆ†ï¼‰" min="0" max="100">
            <input type="number" id="physics-exam" class="form-input" placeholder="ç‰©ç†å®éªŒæ“ä½œæˆç»©ï¼ˆæ»¡åˆ†10åˆ†ï¼‰" min="0" max="10">
            <input type="number" id="history" class="form-input" placeholder="å†å²æˆç»©ï¼ˆæ»¡åˆ†100åˆ†ï¼‰" min="0" max="100">
            <div class="group-divider"></div>
            <!-- åŒ–å­¦+é“æ³•ç»„ -->
            <div class="sub-label">2.2 åŒ–å­¦+é“æ³•ç»„</div>
            <input type="number" id="chemistry-written" class="form-input" placeholder="åŒ–å­¦ç¬”è¯•æˆç»©ï¼ˆæ»¡åˆ†100åˆ†ï¼‰" min="0" max="100">
            <input type="number" id="chemistry-exam" class="form-input" placeholder="åŒ–å­¦å®éªŒæ“ä½œæˆç»©ï¼ˆæ»¡åˆ†10åˆ†ï¼‰" min="0" max="10">
            <input type="number" id="politics" class="form-input" placeholder="é“æ³•æˆç»©ï¼ˆæ»¡åˆ†100åˆ†ï¼‰" min="0" max="100">
            <div class="group-divider"></div>
            <!-- ç”Ÿç‰©+åœ°ç†ç»„ -->
            <div class="sub-label">2.3 ç”Ÿç‰©+åœ°ç†ç»„</div>
            <input type="number" id="biology-written" class="form-input" placeholder="ç”Ÿç‰©ç¬”è¯•æˆç»©ï¼ˆæ»¡åˆ†100åˆ†ï¼‰" min="0" max="100">
            <input type="number" id="biology-exam" class="form-input" placeholder="ç”Ÿç‰©å®éªŒæ“ä½œæˆç»©ï¼ˆæ»¡åˆ†10åˆ†ï¼‰" min="0" max="10">
            <input type="number" id="geography" class="form-input" placeholder="åœ°ç†æˆç»©ï¼ˆæ»¡åˆ†100åˆ†ï¼‰" min="0" max="100">
        </div>
        <!-- è®¡ç®—æŒ‰é’®ä¸ç»“æœ -->
        <button class="calc-btn" onclick="calculateTotal()">è®¡ç®—æŠ˜ç®—æ€»åˆ†</button>
        <div class="total-result">
            <div class="result-label">æŠ˜ç®—åæ€»åˆ†</div>
            <div class="result-value" id="totalScore">--</div>
            <div class="result-comment" id="scoreComment"></div> <!-- è¯„è¯­å®¹å™¨ -->
        </div>
        <!-- å¾—åˆ†è¯¦æƒ… -->
        <div class="detail-group">
            <h3 class="detail-title">å„é¡¹ç›®å¾—åˆ†è¯¦æƒ…</h3>
            <div class="detail-item">
                <span class="detail-label">è¯­æ–‡ï¼š</span>
                <span class="detail-value" id="detailChinese">--</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">æ•°å­¦ï¼š</span>
                <span class="detail-value" id="detailMath">--</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">è‹±è¯­ï¼š</span>
                <span class="detail-value" id="detailEnglish">--</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">ä½“è‚²ï¼š</span>
                <span class="detail-value" id="detailPe">--</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">ç‰©ç†+å†å²ç»„ï¼š</span>
                <span class="detail-value" id="detailPhHis">--</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">åŒ–å­¦+é“æ³•ç»„ï¼š</span>
                <span class="detail-value" id="detailChPo">--</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">ç”Ÿç‰©+åœ°ç†ç»„ï¼š</span>
                <span class="detail-value" id="detailBiGe">--</span>
            </div>
        </div>
        <!-- æ¸©é¦¨æç¤ºï¼šæ·»åŠ åŸå‰¯æ ‡é¢˜å†…å®¹ä½œä¸ºç¬¬ä¸€æ¡æç¤º -->
        <div class="tip-group">
            <div class="tip-title">æ¸©é¦¨æç¤º</div>
            <div class="tip-content">
                1. è®¡ç®—æ ‡å‡†è¯´æ˜ï¼šæœ¬å·¥å…·çš„è®¡ç®—æ ‡å‡†ä¾é çš„æ˜¯æ¹›æ±Ÿæ•™è‚²å±€å…¬å¼€å¯æŸ¥è¯¢åˆ°çš„æ ‡å‡†ï¼Œæˆªæ­¢åˆ°2025å¹´11æœˆä»æœ‰æ•ˆï¼›<br>
                2. ç§‘ç›®ç»„è§„åˆ™ï¼šè‹¥åŒä¸€ç§‘ç›®ç»„å†…æœ‰ä¸€ç§‘æœªè€ƒï¼ˆç•™ç©ºï¼‰ï¼Œå¦ä¸€ç§‘è‡ªåŠ¨æŒ‰é«˜åˆ†ç§‘ç›®è®¡ç®—ï¼›<br>
                3. å®éªŒåˆ†è§„åˆ™ï¼šè‹¥å®éªŒæ“ä½œæˆç»©ç•™ç©ºï¼Œé»˜è®¤ä¸è®¡ç®—å®éªŒåˆ†ï¼Œä»…æŒ‰ç¬”è¯•æˆç»©100%è®¡å…¥æ€»åˆ†ï¼›<br>
                4. å°æ•°å¤„ç†è§„åˆ™ï¼š<br>
                   â€¢ å°æ•°ï¼œ0.25ï¼šè®°0<br>
                   â€¢ 0.25â‰¤å°æ•°ï¼œ0.75ï¼šè®°0.5<br>
                   â€¢ å°æ•°â‰¥0.75ï¼šè®°1
            </div>
        </div>
    </div>
    <!-- å†å²è®°å½•å¼¹çª— -->
    <div class="history-modal" id="historyModal">
        <div class="history-content">
            <button class="close-modal" onclick="closeHistoryModal()">&times;</button>
            <h3 class="history-title">è®¡ç®—å†å²è®°å½•</h3>
            <div id="historyList" class="history-list">
                <!-- å†å²è®°å½•ä¼šé€šè¿‡JSåŠ¨æ€æ’å…¥ï¼Œæ— è®°å½•æ—¶æ˜¾ç¤ºä¸‹æ–¹ç©ºæç¤º -->
                <div class="history-empty">æš‚æ— è®¡ç®—è®°å½•</div>
            </div>
        </div>
    </div>
    <script>

// ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•ï¼ˆé¡µé¢åˆå§‹åŒ–æ—¶æ‰§è¡Œï¼‰
let calculateHistory = JSON.parse(localStorage.getItem('zhongkaoCalcHistory')) || [];
// è¾“å…¥æ¡†é¡ºåºåˆ—è¡¨ï¼šæŒ‰é¡µé¢æ˜¾ç¤ºé¡ºåºæ’åˆ—ï¼Œç”¨äºå›è½¦åˆ‡æ¢
const inputOrder = [
    'chinese', 'math', 'english', 'pe-score',
    'physics-written', 'physics-exam', 'history',
    'chemistry-written', 'chemistry-exam', 'politics',
    'biology-written', 'biology-exam', 'geography'
];
// æ–°å¢ï¼šåˆ†æ•°æ®µå¯¹åº”è¯„è¯­
const scoreComments = [
    { min: 700, comment: 'æ€»åˆ†é¡¶å°–ï¼å®åŠ›è¶…ç¾¤ï¼Œä¿æŒçŠ¶æ€å†²åˆºç†æƒ³é«˜ä¸­ï¼' },
    { min: 640, max: 699, comment: 'æˆç»©ä¼˜ç§€ï¼å°å¹…ä¼˜åŒ–ç»†èŠ‚ï¼Œå³å¯å‘é¡¶å°–è¿ˆè¿›ï¼' },
    { min: 580, max: 639, comment: 'åŸºç¡€æ‰å®ï¼é’ˆå¯¹æ€§æå‡ï¼Œæ€»åˆ†æœ‰æœ›å¤§å¹…çªç ´ï¼' },
    { min: 520, max: 579, comment: 'è¾¾åˆ°åˆæ ¼çº¿ï¼å·©å›ºä¸»ç§‘åŸºç¡€ï¼Œç¨³æ­¥æå‡æ›´é«˜æ•ˆï¼' },
    { max: 519, comment: 'æ½œåŠ›åè¶³ï¼å…ˆæŠ“åŸºç¡€å¾—åˆ†ï¼Œè¿›æ­¥ä¼šå¾ˆæ˜æ˜¾ï¼' }
];
// 1. æ ¸å¿ƒè®¡ç®—å‡½æ•°
function calculateTotal() {
    // å·¥å…·å‡½æ•°1ï¼šå¤„ç†è¾“å…¥åˆ†æ•°ï¼ˆç•™ç©º/éæ•°å­—é»˜è®¤ä¸º0ï¼Œé™åˆ¶æ»¡åˆ†èŒƒå›´ï¼‰
    const getScore = (id, max = 100) => {
        const inputVal = document.getElementById(id)?.value.trim() || '';
        const numVal = inputVal ? parseFloat(inputVal) : 0;
        return Math.max(0, Math.min(isNaN(numVal) ? 0 : numVal, max));
    };
    // å·¥å…·å‡½æ•°2ï¼šè®¡ç®—ç†ç§‘æœ€ç»ˆæˆç»©ï¼ˆé»˜è®¤å®éªŒ10åˆ†åˆ¶ï¼‰
    const calculateSciFinalScore = (writtenId, examId) => {
        const writtenScore = getScore(writtenId);
        const examScore = getScore(examId, 10); // å®éªŒåˆ†é™åˆ¶æœ€å¤§10åˆ†
        return examScore === 0 ? writtenScore : writtenScore * 0.9 + examScore;
    };
    // å·¥å…·å‡½æ•°3ï¼šæ•´æ•°è¿ç®—è§„é¿æµ®ç‚¹æ•°è¯¯å·®
    const safeMultiply = (score, multiple, divisor) => (score * multiple) / divisor;
    // å·¥å…·å‡½æ•°4ï¼šå°æ•°å¤„ç†ï¼ˆå›ºå®šæ ‡å‡†ï¼‰
    const handleDecimal = (num) => {
        const decimalPart = num - Math.floor(num);
        if (decimalPart < 0.25) {
            return Math.floor(num);
        } else if (decimalPart < 0.75) {
            return Math.floor(num) + 0.5;
        } else {
            return Math.ceil(num);
        }
    };
    // è®¡ç®—åŸºç¡€æ€§ç§‘ç›®å¾—åˆ†
    const chineseFin = handleDecimal(getScore('chinese', 120));
    const mathFin = handleDecimal(getScore('math', 120));
    const englishFin = handleDecimal(safeMultiply(getScore('english', 120), 100, 120));
    const peFin = handleDecimal(getScore('pe-score', 80)); // ä½“è‚²ç›´æ¥80åˆ†åˆ¶
    // è®¡ç®—ç§‘ç›®ç»„å¾—åˆ†ï¼ˆè°ƒç”¨è¾…åŠ©å‡½æ•°ï¼‰
    const physicsFinal = calculateSciFinalScore('physics-written', 'physics-exam');
    const historyFinal = getScore('history');
    const phHisTotal = handleDecimal(getGroupTotal(physicsFinal, historyFinal, 8, 10, 'firstType'));
    const chemistryFinal = calculateSciFinalScore('chemistry-written', 'chemistry-exam');
    const politicsFinal = getScore('politics');
    const chPoTotal = handleDecimal(getGroupTotal(chemistryFinal, politicsFinal, 7, 10, 'firstType'));
    const biologyFinal = calculateSciFinalScore('biology-written', 'biology-exam');
    const geographyFinal = getScore('geography');
    const biGeTotal = handleDecimal(getGroupTotal(biologyFinal, geographyFinal, 1, 2, 'secondType'));
    // è®¡ç®—æ€»åˆ†
    const totalScore = handleDecimal(chineseFin + mathFin + englishFin + peFin + phHisTotal + chPoTotal + biGeTotal);
    // æ›´æ–°é¡µé¢æ˜¾ç¤ºï¼ˆå»æ‰/760åˆ†ï¼Œæ–°å¢è¯„è¯­æ˜¾ç¤ºï¼‰
    document.getElementById('totalScore').textContent = totalScore;
    // åŒ¹é…å¯¹åº”è¯„è¯­
    let comment = '';
    for (let item of scoreComments) {
        if ((!item.min || totalScore >= item.min) && (!item.max || totalScore <= item.max)) {
            comment = item.comment;
            break;
        }
    }
    document.getElementById('scoreComment').textContent = comment;
    // æ›´æ–°è¯¦æƒ…
    document.getElementById('detailChinese').textContent = chineseFin;
    document.getElementById('detailMath').textContent = mathFin;
    document.getElementById('detailEnglish').textContent = englishFin;
    document.getElementById('detailPe').textContent = peFin;
    document.getElementById('detailPhHis').textContent = phHisTotal;
    document.getElementById('detailChPo').textContent = chPoTotal;
    document.getElementById('detailBiGe').textContent = biGeTotal;
    // è®°å½•æœ¬æ¬¡è®¡ç®—ï¼ˆå«æ—¶é—´ã€æ€»åˆ†ã€è¯¦æƒ…ï¼‰
    recordCalculation({
        time: getFormattedTime(),
        total: totalScore,
        comment: comment,
        details: {
            chinese: chineseFin,
            math: mathFin,
            english: englishFin,
            pe: peFin,
            phHis: phHisTotal,
            chPo: chPoTotal,
            biGe: biGeTotal
        }
    });
}
// 2. ç§‘ç›®ç»„å¾—åˆ†è®¡ç®—è¾…åŠ©å‡½æ•°
function getGroupTotal(score1, score2, highMultiple, highDivisor, type) {
    // åŒºåˆ†é«˜åˆ†ã€ä½åˆ†ï¼ˆæœªå­¦/æœªè€ƒç§‘ç›®å¡«0ï¼Œä¸å‚ä¸é«˜ä½åˆ†åˆ¤æ–­ï¼‰
    const [highScore, lowScore] = score1 === 0 
        ? [score2, 0] 
        : (score2 === 0 ? [score1, 0] : (score1 >= score2 ? [score1, score2] : [score2, score1]));
    // é«˜åˆ†æŒ‰æ¯”ä¾‹æŠ˜ç®—
    const highConverted = (highScore * highMultiple) / highDivisor;
    // ä½åˆ†æŒ‰ç­‰çº§èµ‹åˆ†
    let lowConverted = 0;
    if (lowScore > 0) {
        if (lowScore >= 80) {
            // Açº§ï¼šç¬¬ä¸€ç§‘ç±»ï¼ˆç‰©/å²/åŒ–/é“ï¼‰50åˆ†ï¼Œç¬¬äºŒç§‘ç±»ï¼ˆç”Ÿ/åœ°ï¼‰40åˆ†
            lowConverted = type === 'firstType' ? 50 : 40;
        } else if (lowScore >= 15) {
            // B/Cçº§ï¼šç¬¬ä¸€ç§‘ç±»Ã—62.5%ï¼Œç¬¬äºŒç§‘ç±»Ã—50%
            lowConverted = type === 'firstType' ? (lowScore * 5) / 8 : (lowScore * 1) / 2;
        }
        // Dçº§ï¼ˆ<15åˆ†ï¼‰é»˜è®¤0åˆ†ï¼Œæ— éœ€é¢å¤–å¤„ç†
    }
    return highConverted + lowConverted;
}
// 3. å†å²è®°å½•ç›¸å…³å‡½æ•°
// 3.1 è·å–æ ¼å¼åŒ–æ—¶é—´ï¼ˆç²¾ç¡®åˆ°ç§’ï¼šå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’ï¼‰
function getFormattedTime() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hour = String(now.getHours()).padStart(2, '0');
    const minute = String(now.getMinutes()).padStart(2, '0');
    const second = String(now.getSeconds()).padStart(2, '0');
    return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
}
// 3.2 è®°å½•æœ¬æ¬¡è®¡ç®—ï¼ˆå­˜å…¥æœ¬åœ°å­˜å‚¨+æ›´æ–°å†å²åˆ—è¡¨ï¼‰
function recordCalculation(record) {
    // æ·»åŠ æ–°è®°å½•åˆ°æ•°ç»„å¤´éƒ¨ï¼ˆæœ€æ–°è®°å½•åœ¨æœ€å‰ï¼‰
    calculateHistory.unshift(record);
    // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼ˆæœ€å¤š9999æ¡ï¼Œé¿å…æœ¬åœ°å­˜å‚¨è¿‡å¤§ï¼‰
    if (calculateHistory.length > 9999) calculateHistory.pop();
    // å­˜å…¥æœ¬åœ°å­˜å‚¨
    localStorage.setItem('zhongkaoCalcHistory', JSON.stringify(calculateHistory));
    // æ›´æ–°å†å²è®°å½•å¼¹çª—çš„æ˜¾ç¤º
    renderHistoryList();
}
// 3.3 æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
function renderHistoryList() {
    const historyListEl = document.getElementById('historyList');
    if (calculateHistory.length === 0) {
        historyListEl.innerHTML = '<div class="history-empty">æš‚æ— è®¡ç®—è®°å½•</div>';
        return;
    }
    let historyHtml = '';
    calculateHistory.forEach((item, index) => {
        // å…³é”®ä¿®æ”¹ï¼šç”¨â€œæ€»è®°å½•æ•° - å½“å‰ç´¢å¼•â€å¾—åˆ°æ­£ç¡®åºå·ï¼Œæœ€æ–°è®°å½•åºå·æœ€å¤§
        const recordNum = calculateHistory.length - index;
        historyHtml += `
            <div class="history-item">
                <div class="history-time">${item.time}ï¼ˆç¬¬${recordNum}æ¬¡è®¡ç®—ï¼‰</div>
                <div class="history-total">æŠ˜ç®—æ€»åˆ†ï¼š${item.total} | ${item.comment}</div>
                <div class="history-detail">å„ç§‘ç›®è¯¦æƒ…ï¼š</div>
                <div class="history-detail-item">
                    <span>è¯­æ–‡</span>
                    <span>${item.details.chinese}</span>
                </div>
                <div class="history-detail-item">
                    <span>æ•°å­¦</span>
                    <span>${item.details.math}</span>
                </div>
                <div class="history-detail-item">
                    <span>è‹±è¯­</span>
                    <span>${item.details.english}</span>
                </div>
                <div class="history-detail-item">
                    <span>ä½“è‚²</span>
                    <span>${item.details.pe}</span>
                </div>
                <div class="history-detail-item">
                    <span>ç‰©ç†+å†å²ç»„</span>
                    <span>${item.details.phHis}</span>
                </div>
                <div class="history-detail-item">
                    <span>åŒ–å­¦+é“æ³•ç»„</span>
                    <span>${item.details.chPo}</span>
                </div>
                <div class="history-detail-item">
                    <span>ç”Ÿç‰©+åœ°ç†ç»„</span>
                    <span>${item.details.biGe}</span>
                </div>
            </div>
        `;
    });
    historyListEl.innerHTML = historyHtml;
}
// 3.4 æ‰“å¼€å†å²è®°å½•å¼¹çª—
function openHistoryModal() {
    // æ‰“å¼€å‰é‡æ–°æ¸²æŸ“åˆ—è¡¨ï¼ˆç¡®ä¿æ•°æ®æœ€æ–°ï¼‰
    renderHistoryList();
    document.getElementById('historyModal').style.display = 'flex';
}
// 3.5 å…³é—­å†å²è®°å½•å¼¹çª—
function closeHistoryModal() {
    document.getElementById('historyModal').style.display = 'none';
}
// 4. é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ï¼ˆå›è½¦åˆ‡æ¢è¾“å…¥æ¡†ï¼‰
document.addEventListener('DOMContentLoaded', () => {
    // å›è½¦åˆ‡æ¢ä¸‹ä¸€ä¸ªè¾“å…¥æ¡†é€»è¾‘
    inputOrder.forEach((inputId, index) => {
        const input = document.getElementById(inputId);
        if (input) {
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤å›è½¦è¡Œä¸º
                    // ä¸æ˜¯æœ€åä¸€ä¸ªè¾“å…¥æ¡†ï¼Œåˆ™èšç„¦åˆ°ä¸‹ä¸€ä¸ª
                    if (index < inputOrder.length - 1) {
                        const nextInput = document.getElementById(inputOrder[index + 1]);
                        if (nextInput) nextInput.focus();
                    } else {
                        // æœ€åä¸€ä¸ªè¾“å…¥æ¡†æŒ‰å›è½¦ï¼Œè‡ªåŠ¨è§¦å‘è®¡ç®—
                        input.blur();
                        calculateTotal();
                    }
                }
            });
        }
    });
});
</script>
</body>
</html>
